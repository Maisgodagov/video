# ğŸ— Architecture Documentation

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Video Processing Pipeline                     â”‚
â”‚                                                                   â”‚
â”‚  Input: Video files (.mp4, .mov, .avi, .mkv, .webm)            â”‚
â”‚  Output: Structured learning content in DB + JSON               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Main Pipeline                              â”‚
â”‚                       (index.js)                                    â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Config     â”‚  â”‚   Database   â”‚  â”‚  File System â”‚            â”‚
â”‚  â”‚ (config.js)  â”‚  â”‚   (db.js)    â”‚  â”‚   (input/)   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                  â”‚                   â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                           â”‚                                        â”‚
â”‚                           â–¼                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚         â”‚    Process Video Loop           â”‚                       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                           â”‚                                        â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚         â–¼                 â–¼                 â–¼                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚  Step 1  â”‚â”€â”€â”€â”€â–¶â”‚  Step 2  â”‚â”€â”€â”€â”€â–¶â”‚  Step 3  â”‚               â”‚
â”‚   â”‚  Audio   â”‚     â”‚Transcriptâ”‚     â”‚ Analysis â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â”‚                                  â”‚                      â”‚
â”‚         â–¼                                  â–¼                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚  Step 4  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  Step 5  â”‚                â”‚
â”‚   â”‚Exercises â”‚                      â”‚   Save   â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Detailed Pipeline Steps

### Step 1: Audio Extraction
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Audio Extractor Module            â”‚
â”‚        (audio/extractor.js)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  Input:  video.mp4                      â”‚
â”‚           â”‚                              â”‚
â”‚           â–¼                              â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚      â”‚ FFmpeg  â”‚                        â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚           â”‚                              â”‚
â”‚           â”œâ”€ Extract audio track        â”‚
â”‚           â”œâ”€ Convert to WAV              â”‚
â”‚           â”œâ”€ Mono channel                â”‚
â”‚           â””â”€ 16kHz sample rate           â”‚
â”‚           â”‚                              â”‚
â”‚           â–¼                              â”‚
â”‚  Output: audio.wav                      â”‚
â”‚                                          â”‚
â”‚  Tools: fluent-ffmpeg                   â”‚
â”‚  Time:  ~10s per 1min video             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 2: Transcription
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Transcription Module                â”‚
â”‚      (transcription/whisper.js)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  Input:  audio.wav                      â”‚
â”‚           â”‚                              â”‚
â”‚           â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Whisper Model   â”‚                   â”‚
â”‚  â”‚  (whisper-small) â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â”‚                              â”‚
â”‚           â”œâ”€ Speech-to-text              â”‚
â”‚           â”œâ”€ Word-level timestamps       â”‚
â”‚           â””â”€ Language: English           â”‚
â”‚           â”‚                              â”‚
â”‚           â–¼                              â”‚
â”‚  Output: {                               â”‚
â”‚    fullText: "...",                      â”‚
â”‚    chunks: [                             â”‚
â”‚      {text: "word", timestamp: [0,1]}   â”‚
â”‚    ]                                     â”‚
â”‚  }                                       â”‚
â”‚                                          â”‚
â”‚  Tools: @xenova/transformers            â”‚
â”‚  Time:  ~30-60s per 1min audio          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 3: Text Analysis
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Text Analyzer Module               â”‚
â”‚       (analysis/textAnalyzer.js)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  Input:  transcript text                â”‚
â”‚           â”‚                              â”‚
â”‚           â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Ollama + phi3   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â”‚                              â”‚
â”‚           â”œâ”€ Determine CEFR level        â”‚
â”‚           â”œâ”€ Assess speech speed         â”‚
â”‚           â”œâ”€ Analyze grammar complexity  â”‚
â”‚           â”œâ”€ Analyze vocabulary          â”‚
â”‚           â””â”€ Identify topics             â”‚
â”‚           â”‚                              â”‚
â”‚           â–¼                              â”‚
â”‚  Output: {                               â”‚
â”‚    cefrLevel: "B1",                      â”‚
â”‚    speechSpeed: "normal",                â”‚
â”‚    grammarComplexity: "intermediate",    â”‚
â”‚    vocabularyComplexity: "intermediate", â”‚
â”‚    topics: ["Tech", "Education"]         â”‚
â”‚  }                                       â”‚
â”‚                                          â”‚
â”‚  Tools: ollama SDK                      â”‚
â”‚  Time:  ~5-10s                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 4: Exercise Generation
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Exercise Generator Module           â”‚
â”‚      (exercises/generator.js)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  Input:  transcript + analysis          â”‚
â”‚           â”‚                              â”‚
â”‚           â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Ollama + phi3   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â”‚                              â”‚
â”‚           â”œâ”€ Generate vocabulary tasks   â”‚
â”‚           â”œâ”€ Create fill-in-blank       â”‚
â”‚           â”œâ”€ Create multiple choice      â”‚
â”‚           â””â”€ Generate phrase practice    â”‚
â”‚           â”‚                              â”‚
â”‚           â–¼                              â”‚
â”‚  Output: [                               â”‚
â”‚    {                                     â”‚
â”‚      type: "vocabulary",                 â”‚
â”‚      question: "...",                    â”‚
â”‚      options: ["..."],                   â”‚
â”‚      correctAnswer: 0                    â”‚
â”‚    },                                    â”‚
â”‚    ...                                   â”‚
â”‚  ]                                       â”‚
â”‚                                          â”‚
â”‚  Tools: ollama SDK                      â”‚
â”‚  Time:  ~10-15s                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Step 5: Database Storage
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Database Module                    â”‚
â”‚       (database/db.js)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  Input:  Complete video data object     â”‚
â”‚           â”‚                              â”‚
â”‚           â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  MySQL Database  â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚           â”‚                              â”‚
â”‚           â”œâ”€ Insert to                   â”‚
â”‚           â”‚  video_learning_content      â”‚
â”‚           â”‚                              â”‚
â”‚           â”œâ”€ Insert topics to            â”‚
â”‚           â”‚  video_topics                â”‚
â”‚           â”‚                              â”‚
â”‚           â””â”€ Save JSON to                â”‚
â”‚              output/video.json           â”‚
â”‚           â”‚                              â”‚
â”‚           â–¼                              â”‚
â”‚  Output: Database ID + JSON file        â”‚
â”‚                                          â”‚
â”‚  Tools: mysql2                          â”‚
â”‚  Time:  ~1s                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Video   â”‚
â”‚  File    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ video.mp4    â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  audio.wav   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ FFmpeg â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ Transcript   â”‚
                         â”‚ + Timestamps â”‚
                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Analysis    â”‚
                         â”‚  Results     â”‚
                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Exercises   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                       â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚   MySQL DB  â”‚         â”‚   JSON   â”‚
             â”‚             â”‚         â”‚   File   â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## External Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           External Services/Tools               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Ollama     â”‚   â”‚    MySQL     â”‚          â”‚
â”‚  â”‚ (localhost)  â”‚   â”‚   (remote)   â”‚          â”‚
â”‚  â”‚  port 11434  â”‚   â”‚   port 3306  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                  â”‚                   â”‚
â”‚         â”‚  phi3 model      â”‚  Beget hosting    â”‚
â”‚         â”‚  (~2.3GB)        â”‚                   â”‚
â”‚         â”‚                  â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                  â”‚                             â”‚
â”‚                  â–¼                             â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚         â”‚  Node.js App   â”‚                     â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                  â”‚                             â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚         â–¼                 â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  FFmpeg  â”‚      â”‚ Whisper  â”‚              â”‚
â”‚  â”‚(bundled) â”‚      â”‚ (cached) â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Schema

```sql
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        video_learning_content               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Field          â”‚ Type       â”‚ Description   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id             â”‚ INT PK     â”‚ Auto-inc ID   â”‚
â”‚ video_name     â”‚ VARCHAR    â”‚ Filename      â”‚
â”‚ video_url      â”‚ VARCHAR    â”‚ S3 URL (null) â”‚
â”‚ cefr_level     â”‚ ENUM       â”‚ A1-C2         â”‚
â”‚ speech_speed   â”‚ ENUM       â”‚ slow/normal.. â”‚
â”‚ grammar_*      â”‚ ENUM       â”‚ Complexity    â”‚
â”‚ vocabulary_*   â”‚ ENUM       â”‚ Complexity    â”‚
â”‚ topics         â”‚ JSON       â”‚ Array         â”‚
â”‚ transcript_*   â”‚ TEXT/JSON  â”‚ Full + chunks â”‚
â”‚ exercises      â”‚ JSON       â”‚ Array         â”‚
â”‚ processed_at   â”‚ TIMESTAMP  â”‚ Date/time     â”‚
â”‚ status         â”‚ ENUM       â”‚ Status        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N relationship
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             video_topics                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id             â”‚ INT PK     â”‚ Auto-inc ID   â”‚
â”‚ video_id       â”‚ INT FK     â”‚ Foreign key   â”‚
â”‚ topic          â”‚ VARCHAR    â”‚ Topic name    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Configuration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   .env   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  config.js      â”‚
â”‚                 â”‚
â”‚  â”œâ”€ Paths       â”‚
â”‚  â”œâ”€ Database    â”‚
â”‚  â”œâ”€ Ollama      â”‚
â”‚  â”œâ”€ Topics      â”‚
â”‚  â””â”€ Levels      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â–¶ index.js
     â”œâ”€â”€â–¶ db.js
     â”œâ”€â”€â–¶ textAnalyzer.js
     â”œâ”€â”€â–¶ generator.js
     â””â”€â”€â–¶ ...
```

## Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Error Handling Flow          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Process Videoâ”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                           â”‚
â”‚     try â”‚                           â”‚
â”‚         â–¼                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Pipeline    â”‚                  â”‚
â”‚  â”‚   Steps      â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                           â”‚
â”‚         â”‚ Error?                    â”‚
â”‚         â”œâ”€Yesâ”€â–¶ catch              â”‚
â”‚         â”‚         â”‚                 â”‚
â”‚         â”‚         â”œâ”€ Log error      â”‚
â”‚         â”‚         â”œâ”€ Save status    â”‚
â”‚         â”‚         â””â”€ Continue next  â”‚
â”‚         â”‚                           â”‚
â”‚         â””â”€Noâ”€â”€â–¶ Success            â”‚
â”‚                   â”‚                 â”‚
â”‚                   â””â”€ Save results   â”‚
â”‚                                     â”‚
â”‚  Summary at end:                   â”‚
â”‚    âœ“ Successful: N                 â”‚
â”‚    âœ— Failed: M                     â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Module Dependencies

```
index.js
  â”œâ”€ config/config.js
  â”œâ”€ audio/extractor.js
  â”‚   â””â”€ fluent-ffmpeg
  â”‚       â””â”€ @ffmpeg-installer/ffmpeg
  â”œâ”€ transcription/whisper.js
  â”‚   â””â”€ @xenova/transformers
  â”œâ”€ analysis/textAnalyzer.js
  â”‚   â”œâ”€ ollama
  â”‚   â””â”€ config/config.js
  â”œâ”€ exercises/generator.js
  â”‚   â”œâ”€ ollama
  â”‚   â””â”€ config/config.js
  â””â”€ database/db.js
      â”œâ”€ mysql2/promise
      â”œâ”€ config/config.js
      â””â”€ database/migrations.sql
```

## Performance Optimization Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Performance Considerations           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚  1. Whisper Model Size                     â”‚
â”‚     small (default) vs tiny                â”‚
â”‚     trade-off: accuracy vs speed           â”‚
â”‚                                             â”‚
â”‚  2. Ollama Model                            â”‚
â”‚     phi3 (default) is fast                 â”‚
â”‚     can use: llama3.2, mistral, etc.       â”‚
â”‚                                             â”‚
â”‚  3. FFmpeg Settings                         â”‚
â”‚     16kHz mono - optimal for Whisper       â”‚
â”‚                                             â”‚
â”‚  4. Database                                â”‚
â”‚     video_topics table - indexed for       â”‚
â”‚     fast topic-based queries               â”‚
â”‚                                             â”‚
â”‚  5. Parallel Processing (future)           â”‚
â”‚     Currently sequential                   â”‚
â”‚     Can add queue for parallel             â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Scalability Considerations

```
Current:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Video 1  â”‚â”€â”€â”€â”€â–¶â”‚ Video 2  â”‚â”€â”€â”€â”€â–¶â”‚ Video 3  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Sequential processing

Future:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Video 1  â”‚â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                â”œâ”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚  Queue   â”‚
â”‚ Video 2  â”‚â”€â”€â”€â”€â”¤    â”‚ (Redis)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚         â–¼
â”‚ Video 3  â”‚â”€â”€â”€â”€â”˜    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ Workers  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Parallel processing with queue
```

## Security Considerations

```
1. Database Credentials
   âœ“ Stored in config.js
   âœ“ Can use .env
   âœ“ Not committed to git (.gitignore)

2. File System
   âœ“ Input/output dirs are local
   âœ“ Temp files cleaned after processing

3. AI Models
   âœ“ Run locally (no data sent to cloud)
   âœ“ Whisper: local
   âœ“ Ollama: local

4. SQL Injection
   âœ“ Using prepared statements (mysql2)
   âœ“ All values parameterized
```

---

This architecture is designed to be:
- **Modular** - each step is independent
- **Maintainable** - clear separation of concerns
- **Scalable** - can add queue for parallel processing
- **Secure** - local AI, no cloud dependencies
- **Documented** - clear flow and dependencies
